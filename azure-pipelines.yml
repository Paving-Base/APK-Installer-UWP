# Universal Windows Platform
# Build a Universal Windows Platform project using Visual Studio.
# Add steps that test and distribute an app, save build artifacts, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - main
      - perview
  paths:
    include:
      - APKInstaller/**

pr:
  branches:
    include:
      - main
      - perview
  paths:
    include:
      - APKInstaller/**

strategy:
  matrix:
    x86:
      config: x86
    x64:
      config: x64
    ARM64:
      config: ARM64

pool:
  vmImage: windows-latest

variables:
  solution: "*.slnx"
  buildPlatform: $(config)
  buildConfiguration: Release
  appxPackageDir: $(build.artifactStagingDirectory)\AppxPackages\\

steps:
  - task: UseDotNet@2
    displayName: Setup .NET Core App
    inputs:
      packageType: sdk
      version: 10.0.x

  - task: VSBuild@1
    displayName: Restore Solution
    inputs:
      platform: $(config)
      solution: $(solution)
      configuration: $(buildConfiguration)
      msbuildArgs: /t:restore
      msbuildArchitecture: x64
      maximumCpuCount: true

  - task: VSBuild@1
    displayName: Build Solution
    inputs:
      platform: $(config)
      solution: $(solution)
      configuration: $(buildConfiguration)
      msbuildArgs: /p:AppxBundlePlatforms=$(buildPlatform)
        /p:AppxPackageDir=$(appxPackageDir)
        /p:AppxBundle=Never
        /p:UapAppxPackageBuildMode=SideloadOnly
        /p:GenerateAppxPackageOnBuild=true
        /p:AppxPackageSigningEnabled=false
        /p:IsPackable=false
      msbuildArchitecture: x64
      maximumCpuCount: true

  - task: PublishBuildArtifacts@1
    displayName: Publish Artifact
    inputs:
      ArtifactName: MSIX Package
      PathtoPublish: $(build.artifactstagingdirectory)
